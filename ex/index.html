<!doctype html>
<head>
<meta charset="utf-8" />
<script src="../index.js"></script>
<title>evem - example</title>
</head>
<body>
<h1>evem - example</h1>
<h2 style="height: 1/5em;">click &quot;start&quot;</h2>
<form id="form" action="javascript:void(0)">
  <button type="button" id="start">start</button>
</form>
</body>
<script>
window.onload = function () {
    var Timer = function (sec) {
        this.paused = true;
        this.ended  = false;
        this.second(sec);

        var that = this;
        this.on('close', function () { that.emit('end'); });
    };
    ! function (tp) {
        tp.second = function (sec) {
            if (typeof sec === 'undefined' || sec === null) return this.sec;

            var errorMes = '"sec" must be "number" and over "0"';
            if (typeof sec !== 'number' || sec !== parseInt(sec))
                throw new TypeError(errorMes);

            if (sec < 0) throw new RangeError(errorMes);

            this.sec = sec;

            return this;
        };
        tp.start = function () {
            if (this.ended)    return this;
            if (this.sec < 0)  return this.close();
            if (! this.paused) return this;

            var that = this
            , parse = function (sec) {
                var hour = Math.floor(sec / 3600); sec -= hour * 3600;
                var min  = Math.floor(sec / 60);   sec -= min  *   60;
                return [ hour, min, sec ];
            }
            , count = function () {
                if (that.sec < 0) return that.close();

                that.emit.apply(that
                  , [ 'data', that.sec.toString() ].concat(parse(that.sec)));

                --that.sec;
            };

            this.paused = false;
            this.intervalID = setInterval(count, 1000);
            count();
        };
        tp.pause = function () {
            if (this.ended) return this;

            this.paused = true;
            clearInterval( this.intervalID );
            delete this.intervalID;

            return this;
        };
        tp.close = function () {
            if (this.ended) return this;

            this.pause();

            delete this.sec;
            this.ended = true;

            this.emit('close');
            return this;
        };
    }(Timer.prototype = new events.EventEmitter);

    var timer = new Timer(111);

    timer.on('data', function (n, hour, min, sec) {
        document.getElementsByTagName('h2')[0].innerHTML = [ hour, min, sec ].join(':');
    });
    timer.on('end', function () {
        document.getElementsByTagName('h2')[0].innerHTML = 'end';
    });

    document.getElementById('start').onclick = function () {
        timer.paused ? timer.start() : timer.pause();
    };
//    document.getElementById('start').addEventListener('click', function () {
//        timer.paused ? timer.start() : timer.pause();
//    });

};
</script>
